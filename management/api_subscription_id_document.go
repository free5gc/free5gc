/*
 * NRF NFManagement Service
 *
 * NRF NFManagement Service
 *
 * API version: 1.0.0
 * Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package management

import (
	"free5gc/lib/MongoDBLibrary"
	"io/ioutil"
	"net/http"
	"strings"

	"github.com/gin-gonic/gin"
	"go.mongodb.org/mongo-driver/bson"
)

// RemoveSubscription - Deletes a subscription
func RemoveSubscription(c *gin.Context) {

	ID := strings.Split(c.Request.URL.Path, "/")
	subscriptionID := ID[4]

	collName := "Subscriptions"
	filter := bson.M{"subscriptionId": subscriptionID}

	MongoDBLibrary.RestfulAPIDeleteMany(collName, filter)

	c.JSON(http.StatusNoContent, gin.H{})

}

// UpdateSubscription - Updates a subscription
func UpdateSubscription(c *gin.Context) {
	ID := strings.Split(c.Request.URL.Path, "/")
	subscriptionID := ID[4]

	collName := "Subscriptions"
	filter := bson.M{"subscriptionId": subscriptionID}
	patchJSON, _ := ioutil.ReadAll(c.Request.Body)

	if MongoDBLibrary.RestfulAPIJSONPatch(collName, filter, patchJSON) {
		SubscriptionData := MongoDBLibrary.RestfulAPIGetOne(collName, filter)
		c.JSON(http.StatusOK, SubscriptionData)
	} else {
		c.JSON(http.StatusNoContent, gin.H{})
	}
}
