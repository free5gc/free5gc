/*
 * NRF NFManagement Service
 *
 * NRF NFManagement Service
 *
 * API version: 1.0.0
 * Generated by: OpenAPI Generator (https://openapi-generator.tech)
 */

package management

import (
	"encoding/json"
	"free5gc/lib/MongoDBLibrary"
	"free5gc/lib/openapi/models"
	"log"
	"net/http"

	"github.com/gin-gonic/gin"
	"go.mongodb.org/mongo-driver/bson"
)

// Provide SubsciptionId for each request (add by one each time)

// CreateSubscription - Create a new subscription
func CreateSubscription(c *gin.Context) {

	var subscription models.NrfSubscriptionData

	if err := c.ShouldBindJSON(&subscription); err != nil {
		log.Panic(err.Error())
	}

	subscription.SubscriptionId = setsubscriptionId()

	tmp, _ := json.Marshal(subscription)
	var putData = bson.M{}
	json.Unmarshal(tmp, &putData)

	// TODO: need to store Condition !
	if MongoDBLibrary.RestfulAPIPost("Subscriptions", bson.M{"subscriptionId": subscription.SubscriptionId}, putData) == false { // subscription id not exist before
		c.JSON(http.StatusCreated, putData)
	} else {
		c.JSON(http.StatusBadRequest, putData)
	}
}
